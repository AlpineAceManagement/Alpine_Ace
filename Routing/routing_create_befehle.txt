-- Enable pgRouting extension
CREATE EXTENSION IF NOT EXISTS postgis;
CREATE EXTENSION IF NOT EXISTS pgrouting;

ogr2ogr -f "PostgreSQL" PG:"dbname=mydatabase user=myuser password=mypassword" open_streer_map.geojson -nln target_table -lco GEOMETRY_NAME=geom -lco FID=ID -nlt PROMOTE_TO_MULTI -append


-- Drop the table if it already exists
DROP TABLE IF EXISTS pisten_routing CASCADE;

-- Create the table to store ski trails
CREATE TABLE pisten_routing (
    id INTEGER PRIMARY KEY,
    source INTEGER,
    target INTEGER,
    cost FLOAT,
    reverse_cost FLOAT,
    geom GEOMETRY(LineString, 2056) 
);

-- Create a spatial index on the geometry column
CREATE INDEX idx_pisten_routing_geom ON pisten_routing USING GIST (geom);


------------------------------------------------------------------------------------


CREATE TABLE nodes AS
SELECT DISTINCT ST_Intersection(l1.geom, l2.geom) AS geom
FROM your_lines_table l1, your_lines_table l2
WHERE ST_Intersects(l1.geom, l2.geom) AND l1.id < l2.id;
